# BEGA Project Structure

```
BEGA/
â”‚
â”œâ”€â”€ ğŸ“„ README.md                    # Main documentation
â”œâ”€â”€ ğŸ“„ QUICK_START.md               # 30-minute setup guide
â”œâ”€â”€ ğŸ“„ PROJECT_STRUCTURE.md         # This file
â”‚
â”œâ”€â”€ âš™ï¸  Configuration Files
â”‚   â”œâ”€â”€ .env.example                # Environment variables template
â”‚   â”œâ”€â”€ .gitignore                  # Git ignore rules
â”‚   â””â”€â”€ docker-compose.yml          # Full stack orchestration
â”‚
â”œâ”€â”€ ğŸ“ config/                      # L2 deployment configs
â”‚   â”œâ”€â”€ .gitkeep
â”‚   â”œâ”€â”€ deploy-config.template.json # OP Stack deployment template
â”‚   â”œâ”€â”€ genesis.json               # (Generated by op-deployer)
â”‚   â”œâ”€â”€ rollup.json                # (Generated by op-deployer)
â”‚   â””â”€â”€ artifacts.json             # (Generated by op-deployer)
â”‚
â”œâ”€â”€ ğŸ” secrets/                     # Private keys & secrets
â”‚   â”œâ”€â”€ .gitkeep                   # (Never commit actual secrets!)
â”‚   â”œâ”€â”€ jwt.txt                    # geth â†” node auth
â”‚   â”œâ”€â”€ sequencer.key              # Sequencer private key
â”‚   â”œâ”€â”€ batcher.key                # Batcher private key
â”‚   â””â”€â”€ proposer.key               # Proposer private key
â”‚
â”œâ”€â”€ ğŸ’¾ data/                        # op-geth database
â”‚   â””â”€â”€ .gitkeep                   # (Auto-generated, excluded from git)
â”‚
â”œâ”€â”€ ğŸ¤– gas-bot/                     # Gas Price Updater Bot
â”‚   â”œâ”€â”€ main.go                    # Bot implementation (Go)
â”‚   â”œâ”€â”€ go.mod                     # Go dependencies
â”‚   â”œâ”€â”€ Dockerfile                 # Container build spec
â”‚   â””â”€â”€ README.md                  # Bot documentation
â”‚
â”œâ”€â”€ ğŸ› ï¸  scripts/                    # Utility scripts
â”‚   â”œâ”€â”€ setup-secrets.sh           # Interactive secret setup
â”‚   â””â”€â”€ check-health.sh            # System health checker
â”‚
â””â”€â”€ ğŸ“š Docs/                        # Architecture & guides
    â”œâ”€â”€ LoadMap.md                 # Development roadmap
    â”œâ”€â”€ checklist.md               # Architecture overview
    â”œâ”€â”€ deploy-config.md           # Config documentation
    â”œâ”€â”€ BlockChainExplorer/        # Blockscout setup
    â”œâ”€â”€ Bridge/                    # Bridge UI setup
    â”œâ”€â”€ Dynamic Gas Price Updater/ # Gas bot guides
    â”œâ”€â”€ operate/                   # Operations guides
    â””â”€â”€ security/                  # Security hardening
```

## Key Files Explained

### Configuration Layer

| File | Purpose | When to Edit |
|------|---------|--------------|
| `.env.example` | Template for environment variables | Copy to `.env` and fill in values |
| `docker-compose.yml` | Defines all L2 services | Rarely (only for custom ports/configs) |
| `config/deploy-config.template.json` | OP Stack deployment parameters | Copy to `deploy-config.json` and update addresses |

### Secrets Management

| File | Contains | How to Generate |
|------|----------|-----------------|
| `secrets/jwt.txt` | Geth-Node authentication | `openssl rand -hex 32` |
| `secrets/sequencer.key` | Sequencer private key | Export from wallet (no 0x) |
| `secrets/batcher.key` | Batcher private key (needs L1 ETH) | Export from wallet (no 0x) |
| `secrets/proposer.key` | Proposer private key (needs L1 ETH) | Export from wallet (no 0x) |

### Generated Artifacts

After running `op-deployer bootstrap`, these files appear in `config/`:

| File | Purpose | Used By |
|------|---------|---------|
| `genesis.json` | L2 genesis block definition | `op-geth init` |
| `rollup.json` | Rollup configuration | `op-node` |
| `artifacts.json` | Deployed L1 contract addresses | Update `.env` |

## Docker Services

When you run `docker compose up -d`, these services start:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BEGA L2 Stack                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ l2-geth-init â”‚  (Runs once, then exits)              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚         â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚   l2-geth    â”‚  Execution Layer (EVM)                â”‚
â”‚  â”‚  Port: 8545  â”‚  â€¢ Processes transactions             â”‚
â”‚  â”‚  Port: 8546  â”‚  â€¢ Maintains state                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚         â†•                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚   l2-node    â”‚  Consensus Layer                      â”‚
â”‚  â”‚  Port: 8547  â”‚  â€¢ Sequences blocks                   â”‚
â”‚  â”‚  Port: 9003  â”‚  â€¢ Syncs with L1                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚         â†•                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  l2-batcher  â”‚ â”€â”€â”€â†’ â”‚  Celestia DA â”‚                 â”‚
â”‚  â”‚              â”‚      â”‚ Port: 26658  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â†•                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ l2-proposer  â”‚  Submits state roots to L1            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚         â†•                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ gas-oracle   â”‚  Adjusts gas prices                   â”‚
â”‚  â”‚     bot      â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### Transaction Lifecycle

```
1. User submits tx to l2-geth (port 8545)
           â†“
2. l2-node sequences tx into blocks
           â†“
3. l2-batcher compresses batch â†’ Celestia
           â†“
4. l2-proposer posts state root â†’ L1 Sepolia
           â†“
5. gas-oracle adjusts prices based on ETH/Token ratio
```

### Key Port Mappings

| Service | Port | Protocol | Access |
|---------|------|----------|--------|
| l2-geth | 8545 | HTTP RPC | MetaMask, dApps |
| l2-geth | 8546 | WebSocket | Real-time subscriptions |
| l2-node | 8547 | HTTP RPC | Internal services |
| l2-node | 9003 | P2P | Other L2 nodes (future) |

## Development Workflow

### 1ï¸âƒ£ Initial Setup
```bash
# Setup environment
cp .env.example .env
cp config/deploy-config.template.json config/deploy-config.json

# Edit both files with your values
```

### 2ï¸âƒ£ Deploy L1 Contracts
```bash
# Using OP Stack's op-deployer
cd /path/to/optimism
./bin/op-deployer bootstrap --config /path/to/BEGA/config/deploy-config.json ...
```

### 3ï¸âƒ£ Start L2
```bash
cd /path/to/BEGA
./scripts/setup-secrets.sh
docker compose up -d
```

### 4ï¸âƒ£ Verify
```bash
./scripts/check-health.sh
```

## Next Steps

After getting your local L2 running:

1. **Phase 1**: âœ… Local PoC (You are here!)
2. **Phase 2**: Deploy public testnet on cloud
3. **Phase 3**: Add monitoring & alerting
4. **Phase 4**: Deploy CLOB smart contracts
5. **Phase 5**: Mainnet launch

See [Docs/LoadMap.md](Docs/LoadMap.md) for detailed phases.

## Troubleshooting

### Common Issues

| Symptom | Solution |
|---------|----------|
| Batcher fails to connect to Celestia | Check `DA_SERVER_URL` and ensure Celestia node is running |
| Genesis mismatch error | `rm -rf data/*` and restart |
| Gas oracle not updating | Verify `SYSTEM_CONFIG_ADDRESS` and operator key has ETH |
| No blocks being produced | Check l2-node logs for L1 RPC connection issues |

### Getting Help

1. Check service logs: `docker compose logs -f [service-name]`
2. Review [Docs/](Docs/) for specific component guides
3. Consult OP Stack docs: https://docs.optimism.io/
4. Celestia docs: https://docs.celestia.org/

## Security Notes

ğŸ”´ **CRITICAL**: Never commit the following to version control:
- `.env` file (contains private keys)
- `secrets/` directory (contains private keys)
- `data/` directory (contains blockchain data)

These are already excluded in `.gitignore`.

âœ… **Safe to commit**:
- `.env.example` (template only)
- `config/deploy-config.template.json` (template only)
- All code and documentation files
